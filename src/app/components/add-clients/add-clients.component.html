<div class="modal fade"
     [class.show]="isVisible"
     [style.display]="isVisible ? 'block' : 'none'"
     tabindex="-1"
     aria-labelledby="clientFormModalLabel">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="clientFormModalLabel">
          <ng-icon name="ionCheckmarkCircle" class="me-2 text-primary"></ng-icon>
          {{ isEditMode ? 'Editar Cliente' : 'Cadastrar Novo Cliente' }}
        </h5>
        <button type="button" class="btn-close" (click)="close()" aria-label="Close"></button>
      </div>

      <form [formGroup]="clientForm" (ngSubmit)="onSubmit()">
        <div class="modal-body">
          <div class="row">
            <!-- Nome -->
            <div class="col-md-12 mb-3">
              <label for="name" class="form-label">Nome Completo *</label>
              <input type="text"
                     class="form-control"
                     id="name"
                     formControlName="name"
                     [class.is-invalid]="clientForm.get('name')?.invalid && clientForm.get('name')?.touched"
                     placeholder="Digite o nome completo">
              <div class="invalid-feedback" *ngIf="clientForm.get('name')?.errors?.['required'] && clientForm.get('name')?.touched">
                Nome é obrigatório
              </div>
              <div class="invalid-feedback" *ngIf="clientForm.get('name')?.errors?.['minlength'] && clientForm.get('name')?.touched">
                Nome deve ter pelo menos 3 caracteres
              </div>
            </div>

            <!-- Email -->
            <div class="col-md-12 mb-3">
              <label for="email" class="form-label">Email *</label>
              <input type="email"
                     class="form-control"
                     id="email"
                     formControlName="email"
                     [class.is-invalid]="clientForm.get('email')?.invalid && clientForm.get('email')?.touched"
                     placeholder="exemplo@email.com">
              <div class="invalid-feedback" *ngIf="clientForm.get('email')?.errors?.['required'] && clientForm.get('email')?.touched">
                Email é obrigatório
              </div>
              <div class="invalid-feedback" *ngIf="clientForm.get('email')?.errors?.['email'] && clientForm.get('email')?.touched">
                Digite um email válido
              </div>
            </div>

            <!-- Telefone -->
            <div class="col-md-6 mb-3">
              <label for="phone" class="form-label">Telefone *</label>
              <input type="tel"
                     class="form-control"
                     id="phone"
                     formControlName="phone"
                     [class.is-invalid]="clientForm.get('phone')?.invalid && clientForm.get('phone')?.touched"
                     placeholder="(11) 99999-9999"
                     (input)="($event)">
              <div class="invalid-feedback" *ngIf="clientForm.get('phone')?.errors?.['required'] && clientForm.get('phone')?.touched">
                Telefone é obrigatório
              </div>
              <div class="invalid-feedback" *ngIf="clientForm.get('phone')?.errors?.['pattern'] && clientForm.get('phone')?.touched">
                Digite um telefone válido (11) 99999-9999
              </div>
              <div class="form-text">Formato: (DDD) 9XXXX-XXXX</div>
            </div>

            <!-- Data de Aniversário -->
            <div class="col-md-6 mb-3">
              <label for="birthday" class="form-label">Data de Aniversário *</label>
              <input type="date"
                     class="form-control"
                     id="birthday"
                     formControlName="birthday"
                     [class.is-invalid]="clientForm.get('birthday')?.invalid && clientForm.get('birthday')?.touched">
              <div class="invalid-feedback" *ngIf="clientForm.get('birthday')?.errors?.['required'] && clientForm.get('birthday')?.touched">
                Data de aniversário é obrigatória
              </div>
              <div class="invalid-feedback" *ngIf="clientForm.get('birthday')?.errors?.['invalidDate']">
                Data inválida
              </div>
            </div>

            <!-- Saldo -->
            <div class="col-md-6 mb-3">
              <label for="balance" class="form-label">Saldo Inicial (R$)</label>
              <input type="number"
                     class="form-control"
                     id="balance"
                     formControlName="balance"
                     step="0.01"
                     min="0"
                     placeholder="0,00">
              <div class="form-text">Opcional. Valor inicial do saldo do cliente.</div>
            </div>

            <!-- Status -->
            <div class="col-md-6 mb-3">
              <div class="form-check form-switch mt-4">
                <input class="form-check-input"
                       type="checkbox"
                       id="status"
                       formControlName="status">
                <label class="form-check-label" for="status">
                  Cliente ativo no sistema
                </label>
              </div>
            </div>
          </div>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" (click)="close()">
            <ng-icon name="ionCloseCircle" class="me-1"></ng-icon>
            Cancelar
          </button>
          <button type="submit"
                  class="btn btn-primary"
                  [disabled]="clientForm.invalid || loading">
            <span *ngIf="loading" class="spinner-border spinner-border-sm me-2"></span>
            <ng-icon [name]="isEditMode ? 'ionCheckmarkCircle' : 'ionCheckmarkCircle'" class="me-1"></ng-icon>
            {{ isEditMode ? 'Atualizar' : 'Cadastrar' }}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<div class="modal-backdrop fade show" *ngIf="isVisible"></div>
