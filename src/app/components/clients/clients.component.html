<div class="container-fluid">
  <div *ngIf="loading" class="text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Carregando...</span>
    </div>
    <p class="mt-2 text-muted">Carregando clientes...</p>
  </div>

  <div *ngIf="error && !loading" class="alert alert-danger alert-dismissible fade show" role="alert">
    <strong>Erro!</strong> {{ error }}
    <button type="button" class="btn-close" (click)="error = ''"></button>
  </div>

  <div *ngIf="!loading">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h2 class="mb-0">Gerenciamento de Clientes</h2>
      <button class="btn btn-primary" (click)="openCreateFormModal()">
        <ng-icon name="ionCheckmarkCircle" class="me-2"></ng-icon>
        Cadastrar Novo Cliente
      </button>
    </div>

    <div class="d-flex justify-content-between align-items-center mb-3">
      <div>
        <span class="text-muted">
          Mostrando {{ clients.length }} de {{ paginationData?.totalElements || 0 }} clientes
        </span>
      </div>

      <div class="d-flex align-items-center gap-2">
        <label class="form-label mb-0">Itens por página:</label>
        <select class="form-select form-select-sm"
                [value]="pageSize"
                (change)="changePageSize($any($event.target).value)"
                style="width: auto;">
          <option *ngFor="let size of pageSizes" [value]="size">{{ size }}</option>
        </select>
      </div>
    </div>

    <div class="table-responsive">
      <table class="table table-bordered table-striped table-hover">
        <thead class="table-dark">
          <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Email</th>
            <th>Birthday</th>
            <th>Balance</th>
            <th>Status</th>
            <th width="200">Ações</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let client of clients">
            <td>{{ client.id }}</td>
            <td>{{ client.name }}</td>
            <td>{{ client.email }}</td>
            <td>{{ client.birthday | date : "dd/MM/yyyy" }}</td>
            <td>R$ {{ client.balance | number : "1.2-2" : "pt-BR" }}</td>
            <td>
              <ng-icon
                name="ionLockOpen"
                *ngIf="client.status"
                class="text-success"
                style="font-size: 20px"
                title="Ativo"
              />
              <ng-icon
                name="ionLockClosed"
                *ngIf="!client.status"
                class="text-danger"
                style="font-size: 20px"
                title="Inativo"
              />
            </td>
            <td>
              <button class="btn btn-info btn-sm me-2" (click)="editClientForm(client)">
                Editar
              </button>
              <button class="btn btn-danger btn-sm" (click)="callModalConfirmRemove(client)">
                Excluir
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <div *ngIf="clients.length === 0" class="text-center py-5">
      <p class="text-muted">Nenhum cliente encontrado.</p>
    </div>

    <div *ngIf="paginationData && paginationData.totalPages > 1"
         class="d-flex justify-content-between align-items-center mt-4">
      <div>
        <span class="text-muted">
          Página {{ currentPage + 1 }} de {{ paginationData.totalPages }}
        </span>
      </div>

      <div class="d-flex align-items-center gap-1">
        <button class="btn btn-outline-primary btn-sm"
                (click)="previousPage()"
                [disabled]="currentPage === 0">
          <ng-icon name="ionChevronBack"></ng-icon> Anterior
        </button>

        <!-- Números das páginas -->
        <ng-container *ngFor="let page of getPageNumbers()">
          <button class="btn btn-sm"
                  [class.btn-primary]="page === currentPage"
                  [class.btn-outline-primary]="page !== currentPage"
                  (click)="changePage(page)">
            {{ page + 1 }}
          </button>
        </ng-container>

        <!-- Botão Próximo -->
        <button class="btn btn-outline-primary btn-sm"
                (click)="nextPage()"
                [disabled]="paginationData.last">
          Próximo <ng-icon name="ionChevronForward"></ng-icon>
        </button>
      </div>
    </div>
  </div>
</div>

<app-add-clients
  [isVisible]="showFormModal"
  [clientData]="selectedClient"
  [loading]="formLoading"
  (onClose)="closeFormModal()"
  (onSubmitForm)="handleFormSubmit($event)">
</app-add-clients>
